/*	
 *	jQuery Touch Optimized Sliders "R"Us 1.3.1
 *	
 *	Copyright (c) 2013 Fred Heusschen
 *	www.frebsite.nl
 *
 *	Plugin website:
 *	tosrus.frebsite.nl
 *
 *	Dual licensed under the MIT and GPL licenses.
 *	http://en.wikipedia.org/wiki/MIT_License
 *	http://en.wikipedia.org/wiki/GNU_General_Public_License
 */


(function(a){function h(a,b,c,d,e){e.slides.collect?i(a,b,c,d,e):j(a,b,c,d,e);var f=d.children();e.slides.css&&f.css(e.slides.css);var g=e.slides.width;return e.slidesWidthPercentage&&(g+="%"),f.css("width",g),f}function i(b,c,d,e,f){y(c,f).addClass(H("zoom")),c.css(f.anchors.css).each(function(b){var c=a(this),g=a('<div class="'+H("slide")+" "+H("loading")+'" />').data(I("anchor"),c).data(I("content"),c.attr("href")).appendTo(e);if(c.data(I("slide"),g).bind(J(f.anchors.event),function(a){a.preventDefault(),d.trigger(J("open"),[b])}),f.caption){g.data(I("caption"),"");for(var h in f.caption){var i=c.attr(f.caption[h]);if(i&&i.length){g.data(I("caption"),i);break}}}})}function j(b,c,d,e,f){b.children().each(function(){var c=a(this);a('<div class="'+H("slide")+'" />').append(c).appendTo(e),c=c.parent(),c.data(I("caption"),"");var d=c.children(),g="html",h="youtube";if(d.is("img"))g="image";else if(d.is("iframe")&&d.attr("src")){var i=d.attr("src").toLowerCase();i.indexOf("youtube.com/embed/")>-1?g="video":i.indexOf("vimeo.com/video/")>-1&&(g="video",h="vimeo")}switch(c.data(I("contenttype"),g),g){case"image":f.touch.zoom&&a.fn.TosRUs.pinchZoom(d);break;case"html":d.wrap('<div class="'+H("content")+'" />');break;case"video":c.data(I("videotype"),h),k(c,f.video.ratio,f.video.maxWidth,f.video.maxHeight)}})}function k(a,c,d,e){var f=a.children();a.addClass(H("video")).bind(J("resizeVideo"),function(){f.removeAttr("style");var b=a.width(),g=a.height();d&&b>d&&(b=d),e&&g>e&&(g=e),c>b/g?g=b/c:b=g*c,f.width(b),f.height(g)}),b.bind(J("resize"),function(){a.trigger(J("resizeVideo"))})}function l(b,c){a.each(c,function(a,c){c&&c.bind(J("click"),function(c){c.stopPropagation(),c.preventDefault(),b.trigger(J(a))})})}function m(b,c){(c.prev.key||c.next.key||c.close.key)&&a(document).bind(J("keyup"),function(a){var d=a.keyCode;(27==d||37==d||39==d)&&b.data(I("opened"))&&(27==d&&c.close.key?(a.preventDefault(),b.trigger(J("close"))):(37==d&&c.prev.key||39==d&&c.next.key)&&(a.preventDefault(),b.trigger(J(37==d?"prev":"next"))))})}function n(b,c,d,e,f){var h=g;a.isNumeric(d)&&(h=d,d=!1),d?b.css(c):setTimeout(function(){b.animate(c,{duration:h,complete:e,easing:f,queue:!1})},1)}function o(b,c,d){return a("<div />").css("width",c).animate({width:d},{duration:g/2,step:function(a){b.css({transform:"scale("+a+")"})}}),d}function p(a,b,c){return"number"==typeof b&&b>a&&(a=b),"number"==typeof c&&a>c&&(a=c),a}function q(a,b){return b.data(I("index"),a),a}function r(a,b){return b.data(I("opened"),a),a}function s(a,b,c,d,e){a&&a[(1>c?"add":"remove")+"Class"](H("disabled")),b&&b[(c>=d-e.slides.visible?"add":"remove")+"Class"](H("disabled"))}function t(b,c,d){if(e){var f=e.getScale();if(f!==void 0){f=1/f;for(var g=a(),h=0,i=b.length;i>h;h++)b[h]&&(g=g.add(b[h]));setTimeout(function(){c&&c.css({"text-size-adjust":Math.ceil(100*p(f,1,3))+"%"}),g.css({transform:"scale("+p(f,1,2)+")"})},d||1)}}}function u(a,b,c){v(a,b,b+c.slides.visible,c),setTimeout(function(){v(a,b-c.slides.visible,b,c),v(a,b+c.slides.visible,b+2*c.slides.visible,c)},500)}function v(b,c,d,e){b.children().slice(c,d).each(function(){var c=a(this);if(0==c.children().length){var d=c.data(I("content")),f=d,g=!1,h="youtube";switch(a.inArray(d.toLowerCase().split(".").pop().split("?")[0],["jpg","jpe","jpeg","gif","png"])>-1?g="image":0==d.indexOf("#")?(d=a(d),g="html"):d.toLowerCase().indexOf("youtube.com/watch")>-1?(d=d.split("?v=")[1].split("&")[0],e.video.imageLink?(d="http://img.youtube.com/vi/"+d+"/0.jpg",g="videolink"):(d="http://www.youtube.com/embed/"+d,g="video")):d.toLowerCase().indexOf("vimeo.com/")>-1&&(d="http://player.vimeo.com/video/"+d.split("vimeo.com/")[1].split("?")[0]+"?api=1",g="video",h="vimeo"),c.data(I("contenttype"),g),g){case"image":case"videolink":a('<img border="0" />').bind(J("load"),function(b){b.stopPropagation(),c.removeClass(H("loading")),"videolink"==g?a('<a href="'+f+'" class="'+H("play")+'" />').appendTo(c):e.touch.zoom&&a.fn.TosRUs.pinchZoom(a(this))}).appendTo(c).attr("src",d);break;case"html":c.removeClass(H("loading")),a('<div class="'+H("content")+'" />').append(d).appendTo(c);break;case"video":c.data(I("videotype"),h);var i=c.data(I("anchor"));a('<iframe src="'+d+'" frameborder="0" allowfullscreen />').appendTo(c),k(c,i.data(I("ratio"))||e.video.ratio,i.data(I("maxWidth"))||e.video.maxWidth,i.data(I("maxHeight"))||e.video.maxHeight),setTimeout(function(){c.removeClass(H("loading"))},2500)}b.parent().trigger("loading",[c.data(I("anchor")),c])}"video"==c.data(I("contenttype"))&&c.trigger(J("resizeVideo"))})}function w(b,c){b.each(function(){var b=a(this),d=b.find("iframe")[0];switch(b.data(I("videotype"))){case"youtube":d.contentWindow.postMessage('{ "event": "command", "func": "'+c+'Video" }',"*");break;case"vimeo":"stop"==c&&(c="unload"),d.contentWindow.postMessage('{ "method": "'+c+'" }',"*")}})}function x(b,c){var d=a();return c.slides.collect&&(d=d.add(b.filter('a[href$=".gif"]')),d=d.add(b.filter('a[href$=".png"]')),d=d.add(b.filter('a[href$=".jpg"]')),d=d.add(b.filter('a[href$=".jpe"]')),d=d.add(b.filter('a[href$=".jpeg"]')),d=d.add(b.filter('a[href^="#"][href!="#"]')),d=d.add(b.filter('a[href*="youtube.com/watch?v="]')),d=d.add(b.filter('a[href*="vimeo.com/"]'))),d}function y(b,c){var d=a();return c.anchors.zoomIcon&&b.each(function(){var b=a(this),c=b.children();1==c.length&&c.is("img")&&c.width()>99&&c.height()>99&&(d=d.add(b))}),d}function z(b,c,d){if(a.isFunction(b.wrapper)?b.wrapper={target:b.wrapper.call(d)}:"string"==typeof b.wrapper&&(b.wrapper={target:a(b.wrapper)}),b.wrapper=B(b.wrapper,{}),"boolean"==typeof b.touch&&(b.touch={drag:b.touch,zoom:b.touch}),b.touch=B(b.touch,{}),a.isNumeric(b.slides)?b.slides={visible:b.slides}:"string"==typeof b.slides&&(b.slides={scale:b.slides}),b.slides=B(b.slides,{}),"boolean"==typeof b.anchors?b.anchors={zoomIcon:b.anchors}:"string"==typeof b.anchors&&(b.anchors={event:b.anchors}),b.anchors=B(b.anchors,{}),a.isNumeric(b.video)&&(b.video={ratio:b.video}),b.video=B(b.video,{}),b.wrapper.css=B(b.wrapper.css,{}),a.isFunction(b.wrapper.target)&&(b.wrapper.target=b.wrapper.target.call(d)),"string"==typeof b.wrapper.target&&(b.wrapper.target=a(b.wrapper.target)),b.wrapper.target instanceof a&&0!=b.wrapper.target.length||(b.wrapper.target=b.slides.collect===!1?c:"window"),b.show=C(b.show,!("window"==b.wrapper.target)),b.touch=a.fn.hammer?{drag:C(b.touch.drag,f),zoom:C(b.touch.zoom,f&&"window"==b.wrapper.target)}:{drag:!1,zoom:!1},b.buttons=C(b.buttons,!b.touch.drag),b.keys=C(b.keys,!b.touch.drag&&!b.buttons),"string"==typeof b.caption&&(b.caption=[b.caption]),b.caption===!1||a.isArray(b.caption)||(b.caption="window"==b.wrapper.target||b.caption===!0?["rel","title"]:!1),a.isNumeric(b.slides.width))b.slidesWidthPercentage=!1,b.slides.visible=D(b.slides.visible,1);else{var e=F(b.slides.width)?G(b.slides.width):!1;b.slidesWidthPercentage=!0,b.slides.visible=D(b.slides.visible,e?Math.floor(100/e):1),b.slides.width=e?e:Math.ceil(1e4/b.slides.visible)/100}return b.slides.offset=F(b.slides.offset)?G(b.slides.offset):D(b.slides.offset,0),b.slides.collect=C(b.slides.collect,"window"==b.wrapper.target),b.slides.scale=E(b.slides.scale,"fit"),b.slides.css=B(b.slides.css,{}),b.anchors.zoomIcon=C(b.anchors.zoomIcon,!f&&"window"==b.wrapper.target),b.anchors.event=E(b.anchors.event,"click"),b.anchors.css=B(b.anchors.css,{}),b=A("prev",b),b=A("next",b),b=A("close",b),b.video.ratio=D(b.video.ratio,16/9),b.video.maxWidth=D(b.video.maxWidth,!1),b.video.maxHeight=D(b.video.maxHeight,!1),b.video.imageLink=C(b.video.imageLink,f),b}function A(b,c){var d="close"!=b;switch(d&&a.isNumeric(c[b])&&(c[b]={slides:c[b]}),typeof c[b]){case"boolean":case"string":c[b]={button:c[b]}}if(a.isPlainObject(c[b])||(c[b]={}),d&&(!a.isNumeric(c[b].slides)||1>c[b].slides)&&(c[b].slides=c.slides.visible),"string"==typeof c[b].button&&(c[b].button=a(c[b].button)),!(c[b].button instanceof a)){var e=d?c.buttons:"window"==c.wrapper.target;c[b].button=C(c[b].button,e)}var f=d?c.keys:"window"==c.wrapper.target&&!c[b].button;return c[b].key=C(c[b].key,f),c}function B(b,c){return a.isPlainObject(b)||(b=c),b}function C(a,b){return"boolean"!=typeof a&&(a=b),a}function D(b,c){return a.isNumeric(b)||(b=c),b}function E(a,b){return"string"!=typeof a&&(a=b),a}function F(a){return"string"==typeof a&&"%"==a.slice(-1)}function G(a){return parseInt(a.slice(0,-1))}if(!a.fn.TosRUs){var b,c,d,e=!1,f="ontouchstart"in window,g=400;a.fn.TosRUs=a.fn.tosrus=function(i,j,k){if(0==this.length)return this;var o=this,p=this[0];i=B(i,{}),i=f?a.extend(!0,{},i,k):a.extend(!0,{},i,j);var v=z(i,o,p),y="window"==v.wrapper.target,A=0,C=0,D=0;b=a(window),c=a("html"),d=a("body"),!e&&f&&"undefined"!=typeof FlameViewportScale&&(e=new FlameViewportScale);var E=a('<div class="'+H("wrapper")+'" />'),F=a('<div class="'+H("slider")+'" />').appendTo(E),G=null,K=null,L=null,M=null;E.css(v.wrapper.css).addClass(H(y?"fixed":"inline")).addClass(H(f?"touch":"desktop")).addClass(H(v.slides.scale)),v.caption&&(K=a('<div class="'+H("caption")+'" />').appendTo(E)),v.prev.button&&(L=v.prev.button instanceof a?v.prev.button:a('<a class="'+H("prev")+'" href="#" />').appendTo(E)),v.next.button&&(M=v.next.button instanceof a?v.next.button:a('<a class="'+H("next")+'" href="#" />').appendTo(E)),v.close.button&&(G=v.close.button instanceof a?v.close.button:a('<a class="'+H("close")+'" href="#" />').appendTo(E));var N=x(o,v),O=h(o,N,E,F,v);C=O.length,A=q(A,E),E.bind(J(""),function(a){a.stopPropagation()}).bind(J("open"),function(c,d,e){P||(y&&(D=b.scrollTop()),E.show().css("opacity",0).addClass(H("hover")),n(E,{opacity:1},e),t([L,M,G],K),E.trigger(J("opening"),[d,e])),u(F,A,v),e=e||!P,P=r(!0,E),a.isNumeric(d)&&E.trigger(J("slideTo"),[d,e])}).bind(J("close"),function(a,b){P&&(E.removeClass(H("hover")),w(E.find("."+H("video")),"stop"),b===void 0&&(b=g/2),n(E,{opacity:0},b,function(){E.hide()}),E.trigger(J("closing"),[b])),P=r(!1,E)}).bind(J("prev")+" "+J("next"),function(b,c,d,e){a.isNumeric(c)||(c=v[b.type].slides),E.trigger(J("slideTo"),["prev"==b.type?A-c:A+c,d,e])}).bind(J("slideTo"),function(b,c,d,e){if(!P)return!1;if(!a.isNumeric(c))return!1;var f=!0;0>c?(c=0,0==A&&(f=!1)):c+v.slides.visible>C&&(c=C-v.slides.visible,A+v.slides.visible>=C&&(f=!1));var g=F.children().eq(A);if(A=q(c,E),u(F,A,v),s(L,M,A,C,v),f){var h=0-A*v.slides.width+v.slides.offset;if(v.slidesWidthPercentage&&(h+="%"),n(F,{left:h},d,null,e),v.caption){var i=F.children().eq(A).data(I("caption"));K.text(i)[i.length>0?"show":"hide"]()}w(g.filter("."+H("video")),"pause"),E.trigger(J("sliding"),[A,d])}}).bind(J("click"),function(){E.toggleClass(H("hover"))}),s(L,M,A,C,v),l(E,{prev:L,next:M,close:G}),b.bind(J("orientationchange"),function(){P&&t([L,M,G],K,250)}),m(E,v),v.touch.drag&&a.fn.TosRUs.dragSlide(E,v.slides.visible,C),y&&b.bind(J("scroll"),function(a){P&&(window.scrollTo(0,D),a.preventDefault(),a.stopImmediatePropagation())});var P=r(!0,E);return y?E.appendTo(d).trigger(J("close"),[!0]):(E.appendTo(v.wrapper.target),v.show?(P=r(!1,E),E.trigger(J("open"),[0,!0])):E.trigger(J("close"),[!0])),E},a.fn.TosRUs.isTouch=f,a.fn.TosRUs.dragSlide=function(a,b,c){var d=a.find("> ."+H("slider")),e=0,f=!1,h=!1;a.hammer().on(J("dragleft")+" "+J("dragright"),function(g){g.gesture.preventDefault(),g.stopPropagation(),e=g.gesture.deltaX,f=g.gesture.direction,h=!1,("left"==f&&a.data(I("index"))+b>=c||"right"==f&&0==a.data(I("index")))&&(e/=2.5),d.css("marginLeft",Math.round(e))}).on(J("swipeleft")+" "+J("swiperight"),function(a){a.gesture.preventDefault(),a.stopPropagation(),h=!0}).on(J("dragend"),function(c){c.gesture.preventDefault(),c.stopPropagation();var i=g/2;if("left"==f||"right"==f){var j=null;if(h){var k=b;j="swipeOutTos"}else var l=d.children().first().width(),k=Math.floor((Math.abs(e)+l/2)/l);k>0&&a.trigger(J("left"==f?"next":"prev"),[k,i,j])}n(d,{marginLeft:0},i,null,j),f=!1}).on(J("pinch"),function(a){a.gesture.preventDefault(),a.stopPropagation()})},a.fn.TosRUs.pinchZoom=function(a){var b=1,c=1,d=1,e=1;a.hammer().on(J("pinch"),function(f){f.gesture.preventDefault(),f.stopPropagation(),b=(f.gesture.scale-c)*d,c=f.gesture.scale,e=p(e+b,.5,4),a.css({transform:"scale( "+e+" )"})}).on(J("doubletap"),function(f){f.gesture.preventDefault(),f.stopPropagation(),b=0,c=1,e=d>1?1:3,d=o(a,d,e)}).on(J("release"),function(f){f.gesture.preventDefault(),f.stopPropagation(),b=0,c=1,d=e,1>d&&(e=1,d=o(a,d,e))})},jQuery.extend(jQuery.easing,{swipeOutTos:function(a,b,c,d,e){return d*Math.sin(b/e*(Math.PI/2))+c}});var H=function(a){return"tos-"+a},I=function(a){return"tos-"+a},J=function(a){return a+".tos"}}})(jQuery);